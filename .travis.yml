language: generic

jobs:
  include:
    - stage: build_and_test
      name: NodeJS
      node_js:
        - "8"
        - "10"
        - "11"
      before_script:
        - yarn global add typescript
      script:
        - yarn build
        - yarn test

    - stage: build_and_test
      name: Go
      go:
        - "1.12"
        - "tip"
      env:
        global:
          GO111MODULE=on
          GOCACHE=$HOME/.go-build
      cache:
        directories:
          - $GOCACHE

      before_script:
        - cd packages/go/go-test
      script:
        - go test -v ./...

stages:
  - build_and_test
  - name: release
    if: tag IS present
